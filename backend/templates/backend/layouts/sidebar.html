{% load static %}
{% load user_roles %}

<!-- Sidebar -->
<ul class="navbar-nav sidebar sidebar-dark accordion" id="accordionSidebar" style="background: #1C1C65">

    <!-- Sidebar - Logo -->
    {% if user|has_role:"Admins" %}
        <a class="sidebar-brand d-flex align-items-center justify-content-center" href="{% url 'role_dashboard' role='admins' %}">
            <div class="sidebar-brand-icon rotate-n-15">
                <img src="{% static 'backend/img/Main-logo.png' %}" alt="Company Logo" style="width: 55%; height: auto;" class="img-fluid">
            </div>
        </a>
    {% elif user|has_role:"Staff" %}
         <a class="sidebar-brand d-flex align-items-center justify-content-center" href="{% url 'role_dashboard' role='staff' %}">
            <div class="sidebar-brand-icon rotate-n-15">
                <img src="{% static 'backend/img/Main-logo.png' %}" alt="Company Logo" style="width: 55%; height: auto;" class="img-fluid">
            </div>
        </a>
    {% endif %}

    <hr class="sidebar-divider my-0">

    {% if user|has_role:"Admins" %}
    <!-- Dashboard -->
        <li class="nav-item">
            <a class="nav-link fs-1 {% if request.path == dashboard_url %}active{% endif %}" href="{% url 'role_dashboard' role='admins' %}">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
        </li>
    {% elif user|has_role:"Staff" %}
          <li class="nav-item">
            <a class="nav-link fs-1 {% if request.path == dashboard_url %}active{% endif %}" href="{% url 'role_dashboard' role='staff' %}">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
        </li>
    {% endif %}

    <hr class="sidebar-divider">
    <div class="sidebar-heading">Menu</div>

    {% if user|has_role:"Admins" %}
        <!-- Branches -->
        <li class="nav-item {% if 'branches' in request.path %}active{% endif %}">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseBranches"
               aria-expanded="{% if 'branches' in request.path %}true{% else %}false{% endif %}">
                <i class="fas fa-building"></i>
                <span>Branches</span>
            </a>
            <div id="collapseBranches" class="collapse {% if 'branches' in request.path %}show{% endif %}"
                 data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <a class="collapse-item {% if request.path == '/admins/branch/' %}active{% endif %}"
                       href="{% url 'role_branch' role='admins' %}">
                        List Branch
                    </a>
                </div>
            </div>
        </li>
    {% endif %}

    {% if user|has_role:"Admins" or user|has_role:"Staff" %}
    <!-- Booking -->
    <li class="nav-item {% if 'booking' in request.path %}active{% endif %}">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseBooking"
           aria-expanded="{% if 'booking' in request.path %}true{% else %}false{% endif %}">
            <i class="fas fa-calendar-check"></i>
            <span>Booking</span>
        </a>
        <div id="collapseBooking" class="collapse {% if 'booking' in request.path %}show{% endif %}" data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <a class="collapse-item {% if request.path == booking_url %}active{% endif %}" href="{{ booking_url }}">List Booking</a>
            </div>
        </div>
    </li>
    {% endif %}

    {% if user|has_role:"Admins" or user|has_role:"Staff" %}
    <!-- Customers -->
    <li class="nav-item {% if 'customers' in request.path %}active{% endif %}">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseCustomer"
           aria-expanded="{% if 'customers' in request.path %}true{% else %}false{% endif %}">
            <i class="fas fa-users"></i>
            <span>Customer</span>
        </a>
        <div id="collapseCustomer" class="collapse {% if 'customers' in request.path %}show{% endif %}" data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <a class="collapse-item {% if request.path == customers_url %}active{% endif %}" href="{{ customers_url }}">List Customer</a>
            </div>
        </div>
    </li>
    {% endif %}

    {% if user|has_role:"Admins" %}
    <!-- Product & Service -->
    <li class="nav-item {% if 'product_type' in request.path %}active{% endif %}">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseProduct"
           aria-expanded="{% if 'product_type' in request.path %}true{% else %}false{% endif %}">
            <i class="fas fa-box-open"></i>
            <span>Product & Service</span>
        </a>
        <div id="collapseProduct" class="collapse {% if 'product_type' in request.path %}show{% endif %}" data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <a class="collapse-item {% if request.path == product_type1_url %}active{% endif %}" href="{{ product_type1_url }}">Products</a>
                <a class="collapse-item {% if request.path == product_type2_url %}active{% endif %}" href="{{ product_type2_url }}">Services</a>
            </div>
        </div>
    </li>

    <!-- Categories -->
    <li class="nav-item {% if 'categories' in request.path %}active{% endif %}">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseCategory"
           aria-expanded="{% if 'categories' in request.path %}true{% else %}false{% endif %}">
            <i class="fas fa-layer-group"></i>
            <span>Category</span>
        </a>
        <div id="collapseCategory" class="collapse {% if 'categories' in request.path %}show{% endif %}" data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <a class="collapse-item {% if request.path == categories_url %}active{% endif %}" href="{{ categories_url }}">Category</a>
            </div>
        </div>
    </li>

{#    <!-- Brands -->#}
{#    <li class="nav-item {% if 'brands' in request.path %}active{% endif %}">#}
{#        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseBrands"#}
{#           aria-expanded="{% if 'brands' in request.path %}true{% else %}false{% endif %}">#}
{#            <i class="fas fa-copyright"></i>#}
{#            <span>Brands</span>#}
{#        </a>#}
{#        <div id="collapseBrands" class="collapse {% if 'brands' in request.path %}show{% endif %}" data-parent="#accordionSidebar">#}
{#            <div class="bg-white py-2 collapse-inner rounded">#}
{#                <a class="collapse-item {% if request.path == brands_url %}active{% endif %}" href="{{ brands_url }}">Brand List</a>#}
{#            </div>#}
{#        </div>#}
{#    </li>#}

{#    <!-- Supplier -->#}
{#    <li class="nav-item {% if 'supplier' in request.path %}active{% endif %}">#}
{#        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseSupplier"#}
{#           aria-expanded="{% if 'supplier' in request.path %}true{% else %}false{% endif %}">#}
{#            <i class="fas fa-truck"></i>#}
{#            <span>Supplier</span>#}
{#        </a>#}
{#        <div id="collapseSupplier" class="collapse {% if 'supplier' in request.path %}show{% endif %}" data-parent="#accordionSidebar">#}
{#            <div class="bg-white py-2 collapse-inner rounded">#}
{#                <a class="collapse-item {% if request.path == supplier_url %}active{% endif %}" href="{{ supplier_url }}">Supplier</a>#}
{#            </div>#}
{#        </div>#}
{#    </li>#}
    {% endif %}

    {% if user|has_role:"Admins" or user|has_role:"Staff" %}
    <!-- Invoice -->
    <li class="nav-item {% if 'invoices' in request.path %}active{% endif %}">
        <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseInvoice"
           aria-expanded="{% if 'invoices' in request.path %}true{% else %}false{% endif %}">
            <i class="fas fa-file-invoice"></i>
            <span>Invoice</span>
        </a>
        <div id="collapseInvoice" class="collapse {% if 'invoices' in request.path %}show{% endif %}" data-parent="#accordionSidebar">
            <div class="bg-white py-2 collapse-inner rounded">
                <a class="collapse-item {% if request.path == invoices_url %}active{% endif %}" href="{{ invoices_url }}">Invoice</a>
            </div>
        </div>
    </li>
    {% endif %}



    {% if user|has_role:"Admins" %}
        <hr class="sidebar-divider d-none d-md-block">
        <div class="sidebar-heading">
            <i class="fas fa-cog"></i> General Settings
        </div>

        <!-- Utilities -->
        <li class="nav-item {% if 'dashboard' in request.path %}active{% endif %}">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseUtilities"
               aria-expanded="{% if 'dashboard' in request.path %}true{% else %}false{% endif %}">
                <i class="fas fa-tools"></i>
                <span>Utilities</span>
            </a>
            <div id="collapseUtilities" class="collapse {% if 'dashboard' in request.path %}show{% endif %}" data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">

                    <a class="collapse-item {% if request.path == profile_url %}active{% endif %}" href="{{ profile_url }}">Profile</a>

                        <!-- Dashboard for Admin -->
                        <a href="#" class="collapse-item {% if request.path == users_url %}active{% endif %}">
                            User
                        </a>


                </div>
            </div>
        </li>
    {% endif %}

</ul>
<!-- End of Sidebar -->

<script>
document.addEventListener('DOMContentLoaded', function() {
    const collapses = document.querySelectorAll('.collapse');
    collapses.forEach(collapse => {
        const target = collapse.id;
        const storedState = localStorage.getItem(`sidebar_${target}_state`);
        if (storedState === 'shown') {
            const trigger = document.querySelector(`[data-target="#${target}"]`);
            if (trigger) {
                trigger.classList.remove('collapsed');
                trigger.setAttribute('aria-expanded', 'true');
                collapse.classList.add('show');
            }
        }
        collapse.addEventListener('shown.bs.collapse', function() {
            localStorage.setItem(`sidebar_${target}_state`, 'shown');
        });
        collapse.addEventListener('hidden.bs.collapse', function() {
            localStorage.setItem(`sidebar_${target}_state`, 'hidden');
        });
    });
});
</script>