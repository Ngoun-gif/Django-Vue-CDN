{% load static %}
{% load user_roles %}

<!-- Sidebar -->
<ul class="navbar-nav sidebar sidebar-dark accordion" id="accordionSidebar" style="background: #1C1C65">

    <!-- Sidebar - Logo -->
    {% if user|has_role:"Admins" %}
        <a class="sidebar-brand d-flex align-items-center justify-content-center" href="{% url 'role_dashboard' role='admins' %}">
            <div class="sidebar-brand-icon rotate-n-15">
                <img src="{% static 'backend/img/Main-logo.png' %}" alt="Company Logo" style="width: 55%; height: auto;" class="img-fluid">
            </div>
        </a>
    {% elif user|has_role:"Staff" %}
         <a class="sidebar-brand d-flex align-items-center justify-content-center" href="{% url 'role_dashboard' role='staff' %}">
            <div class="sidebar-brand-icon rotate-n-15">
                <img src="{% static 'backend/img/Main-logo.png' %}" alt="Company Logo" style="width: 55%; height: auto;" class="img-fluid">
            </div>
        </a>
    {% endif %}

    <hr class="sidebar-divider my-0">

    <!-- Dashboard -->
    {% if user|has_role:"Admins" %}
        <li class="nav-item">
            <a class="nav-link fs-1 {% if request.path == '/admins/dashboard/' %}active{% endif %}" href="{% url 'role_dashboard' role='admins' %}">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
        </li>
    {% elif user|has_role:"Staff" %}
        <li class="nav-item">
            <a class="nav-link fs-1 {% if request.path == '/staff/dashboard/' %}active{% endif %}" href="{% url 'role_dashboard' role='staff' %}">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
        </li>
    {% endif %}

    <hr class="sidebar-divider">
    <div class="sidebar-heading">Menu</div>

    <!-- Branches -->
    {% if user|has_role:"Admins" or user|has_role:"Staff" %}
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseBranches"
                aria-expanded="{% if request.path == '/admins/branch/' or request.path == '/staff/branch/' %}true{% else %}false{% endif %}">
                <i class="fas fa-building"></i>
                <span>Branches</span>
            </a>
            
            <div id="collapsebranches" class="collapse {% if request.path == '/admins/branch/' or request.path == '/staff/branch/' %}show{% endif %}" data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <a class="collapse-item {% if request.path == '/admins/branch/' or request.path == '/staff/branch/' %}active{% endif %}" 
                      href="{% if user|has_role:'Admins' %}{% url 'role_branch' role='admins' %}{% else %}{% url 'role_branch' role='staff' %}{% endif %}">
                        List Branch
                    </a>
                </div>
            </div>
        </li>
    {% endif %}

    <!-- Booking -->
    {% if user|has_role:"Admins" or user|has_role:"Staff" %}
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseBooking"
               aria-expanded="{% if request.path == '/admins/booking/' or request.path == '/staff/booking/' %}true{% else %}false{% endif %}">
                <i class="fas fa-calendar-check"></i>
                <span>Booking</span>
            </a>
            <div id="collapseBooking" class="collapse {% if request.path == '/admins/booking/' or request.path == '/staff/booking/' %}show{% endif %}" data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <a class="collapse-item {% if request.path == '/admins/booking/' or request.path == '/staff/booking/' %}active{% endif %}" 
                        href="{% if user|has_role:'Admins' %}{% url 'role_booking' role='admins' %}{% else %}{% url 'role_booking' role='staff' %}{% endif %}">
                        List Booking
                    </a>
                </div>
            </div>
        </li>
    {% endif %}

    <!-- Customers -->
    {% if user|has_role:"Admins" or user|has_role:"Staff" %}
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseCustomer"
               aria-expanded="{% if request.path == '/admins/customer/' or request.path == '/staff/customer/' %}true{% else %}false{% endif %}">
                <i class="fas fa-users"></i>
                <span>Customer</span>
            </a>
            <div id="collapseCustomer" class="collapse {% if request.path == '/admins/customer/' or request.path == '/staff/customer/' %}show{% endif %}" data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <a class="collapse-item {% if request.path == '/admins/customer/' or request.path == '/staff/customer/' %}active{% endif %}" 
                       href="{% if user|has_role:'Admins' %}{% url 'role_customer' role='admins' %}{% else %}{% url 'role_customer' role='staff' %}{% endif %}">
                        List Customer
                    </a>
                </div>
            </div>
        </li>
        
         <!-- Service -->
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseService"
               aria-expanded="{% if request.path == '/admins/service/' or request.path == '/staff/service/' %}true{% else %}false{% endif %}">
                <i class="fas fa-box-open"></i>
                <span>Service</span>
            </a>
             <div id="collapseService" class="collapse {% if request.path == '/admins/service/' or request.path == '/staff/service/' %}show{% endif %}" data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                     <a class="collapse-item {% if request.path == '/admins/service/' or request.path == '/staff/service/' %}active{% endif %}" 
                       href="{% if user|has_role:'Admins' %}{% url 'role_service' role='admins' %}{% else %}{% url 'role_service' role='staff' %}{% endif %}">
                        List Service
                    </a>
                </div>
            </div>
        </li>




    {% endif %}

   
    {% if user|has_role:"Admins" %}

        <!-- Categories -->
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseCategory"
               aria-expanded="{% if request.path == '/admins/category/' %}true{% else %}false{% endif %}">
                <i class="fas fa-layer-group"></i>
                <span>Category</span>
            </a>
            <div id="collapseCategory" class="collapse {% if request.path == '/admins/category/' %}show{% endif %}" data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <a class="collapse-item {% if request.path == '/admins/category/' %}active{% endif %}" 
                       href="{% url 'role_category' role='admins' %}">
                        List Category
                    </a>
                </div>
            </div>
        </li>

        {% comment %} <!-- Subject -->
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseSubject"
               aria-expanded="{% if request.path == '/admins/subject/' %}true{% else %}false{% endif %}">
                <i class="fas fa-book"></i>
                <span>Subject</span>
            </a>
            <div id="collapseSubject" class="collapse {% if request.path == '/admins/subject/' %}show{% endif %}" data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <a class="collapse-item {% if request.path == '/admins/subject/' %}active{% endif %}" 
                       href="{% url 'role_subject' role='admins' %}">Subject</a>
                </div>
            </div>
        </li>

        <!-- Teacher -->
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTeacher"
               aria-expanded="{% if request.path == '/admins/teacher/' %}true{% else %}false{% endif %}">
                <i class="fab fa-teamspeak"></i>
                <span>Teacher</span>
            </a>
            <div id="collapseTeacher" class="collapse {% if request.path == '/admins/teacher/' %}show{% endif %}" data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <a class="collapse-item {% if request.path == '/admins/teacher/' %}active{% endif %}" 
                       href="{% url 'role_teacher' role='admins' %}">Teacher</a>
                </div>
            </div>
        </li> {% endcomment %}
    {% endif %}

    <!-- General Settings -->
    {% if user|has_role:"Admins" %}
        <hr class="sidebar-divider d-none d-md-block">
        <div class="sidebar-heading">
            <i class="fas fa-cog"></i> General Settings
        </div>

        <!-- Utilities -->
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseUse"
               aria-expanded="{% if request.path == '/admins/users/' %}true{% else %}false{% endif %}">
                <i class="fas fa-tools"></i>
                <span>Utilities</span>
            </a>
            <div id="collapseUse" class="collapse {% if request.path == '/admins/user/' %}show{% endif %}" data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <a class="collapse-item {% if request.path == '/admins/user/' %}active{% endif %}"
                       href="{% url 'role_user' role='admins' %}">
                        List User
                    </a>
                </div>
            </div>
        </li>
    {% endif %}



</ul>
<!-- End of Sidebar -->

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Remove any persisted sidebar states from localStorage
    Object.keys(localStorage).forEach(key => {
        if (key.startsWith('sidebar_') && key.endsWith('_state')) {
            localStorage.removeItem(key);
        }
    });

    // Initialize Bootstrap collapse with manual toggle
    const collapses = document.querySelectorAll('.collapse');
    collapses.forEach(collapse => {
        collapse.addEventListener('show.bs.collapse', function() {
            // Close other open collapses in the same accordion
            const parent = this.closest('.accordion');
            if (parent) {
                const openCollapses = parent.querySelectorAll('.collapse.show');
                openCollapses.forEach(openCollapse => {
                    if (openCollapse !== this) {
                        const collapseInstance = bootstrap.Collapse.getInstance(openCollapse);
                        if (collapseInstance) {
                            collapseInstance.hide();
                        }
                    }
                });
            }
        });
    });
});
</script>